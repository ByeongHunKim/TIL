# 스프링 데이터 들여다보기

> *Spring Runner 박용권님의 테크톡 영상을 정리한 내용입니다.*
>
> https://www.youtube.com/watch?v=N6tc44b-ATk&t=3769s
>
> - Spring 데이터 접근 기술 훑어보기
> - Spring ORM 지원 간보기
> - Spring Data JPA 맛보기
> - Spring Data Repositories는 어떻게 동작하는가?

## Spring 데이터 접근 기술 훑어보기

스프링 프레임워크 레퍼런스 중 Data Access 내용을 살펴 본다.

* https://docs.spring.io/spring-framework/docs/current/reference/html/

대부분의 엔터프라이즈 애플리케이션은 데이터를 장기적으로 보존하고 효과적으로 검색을 할 수 있게 해주는 DB와 연결돼서 동작을 하고 있다.

자바는 DB와의 연결과 작업을 위해 표준 인터페이스로 JDBC(Java Database Connectivity)를 제공한다. JDBC와 SQL을 사용하면 어떤 DB를 사용하더라도 일관된 방식으로 데이터를 처리하는 코드를 다룰 수 있다.

JDBC 외에도 객체 관계 매핑 기술(ORM)의 표준인 JPA(Java Persistence)도 제공한다.

JDBC + SQL이나 JPA를 통해서 대규모의 복잡한 데이터를 처리를 할 순 있지만, 객체 내부의 구조를 이해하기 쉽고 변경에 유연하게 만드는 데에는 많은 제약과 노력을 필요로 한다.

Spring은 앞서 말한 제약을 극복하고 보다 간결한 코드로 원하는 기능을 구현할 수 있도록 주요한 데이터 접근 기술을 지원하고 있다.

* JDBC API를 기반으로 추상화 된 API를 제공하고 이를 통해 다양한 DB를 사용할 수 있다.
* 이외에도 ORM 기술인  JPA, Hibernate
* Reactive 기술인 R2DBC를 지원한다.
* 동시에 프로그래밍 방식이나 선언적 방식의 트랜잭션 관리를 지원하는 추상화 계층을 제공하고 있다.

이를 이용하면 일관된 프로그래밍 모델을 유지 하면서도 데이터 접근 기술을 사용할 수 있고, 서비스 추상화를 통해서 애플리케이션의 핵심 코드를 세부 기술로 부터 분리할 수 있도록 도와준다.

### Transaction Management

스프링의 Data Access 레퍼런스의 가장 처음에는 트랜잭션 관리에 대한 내용이 등장한다.

스프링은 데이터 접근 기술과는 무관하게 일관된 방식으로 트랜잭션 관리를 할 수 있도록 서비스 추상화를 제공한다.

특히 선언적 트랜잭션은 굉장히 매력적인 기술인데, 우리가 많이 접하는 @Transactional 을 이용하는 방법이다.

이를 이용하면 POJO의 장점을 유지하면서 트랜잭션 서비스를 유지할 수 있다.

### DAO Support

스프링의 철학을 따라서 애플리케이션을 개발하다 보면 자연스럽게 관심사에 따라서 코드를 분리하게 된다.

이렇게 분리된 코드중에서는 DB와 관련된 작업에 대한 책임을 갖는 DAO(Data Access Object)가 있게 된다.

이 DAO를 이용하면 데이터 접근 기술을 외부에 노출시키지 않을 수 있다. 이를 통해서 우리는 애플리케이션의 핵심 비즈니스 로직에 영향을 주지 않고 데이터 접근 기술을 변경할 수 있고, 하나 이상의 데이터 접근 기술을 사용할 수도 있다.

DAO를 사용하는 도메인계층이나 응용계층의 코드를 기술이나 환경에 종속되지 않게 개발할 수 있는 장점을 누릴 수 있다.

DAO에서 데이터를 접근하는 중에 발생하는 예외는 대부분 복구가 불가능하기 때문에 도메인이나 애플리케이션 계층에서 코드가 직접적으로 예외를 다루는 경우가 거의 없다. 하지만, 때로는 중복키나 Optimistic Locking Exception 등 의미 있는 예외를 잡아서 후처리를 할 필요도 있다.

예외 처리를 하게 될 때, JDBC나 JPA와 같이 특정 데이터 접근 기술에서 발생하는 예외를 사용하게 되면 코드가 오염 될 수 있다. 또한, 데이터 접근 기술마다 제공하는 예외에 일관성이 없어서 세부 기술에 따라서 후처리 방식이 달라지는 문제도 있다.

이 때문에 스프링은 특정 기술이나 DB의 종류에 상관없이 일관된 의미를 갖는 데이터 예외 추상화를 제공한다. 각 기술과 DB에서 발생하는 예외를 스프링의 데이터 예외 계층으로 변환해 주는 서비스도 제공한다.

가장 최상위에는 DataAccessException이 존재하며, 이 예외를 상속받아서 만든 구체화 된 예외들을 데이터 추상화 계층을 통해 제공한다.

### ORM Data Access

ORM은 Java 객체와 RDB 사이에 존재하는 개념, 접근방법, 특성의 차이 때문에 요구되는 불편한 작업들을 제거해줘서 개발자가 객체를 다루면 ORM 프레임워크가 RDB에 적절한 형태로 변환을 해주거나, 그 반대로 RDB에 저장되어 있는 정보를 객체로 변환해 주는 기술이다.

여러가지 구현 기술들이 나와있는 상태지만, 현재는 오픈소스 ORM인 Hibernate가 가장 많이 사용되고 있다.

JPA 같은 경우 ORM 전문가들이 대거 참여한 EJB 3.0을 개발하는 과정에서 기존에 Entity Bean이라는 기술을 JPA라는 이름으로 바꾸고, 표준 자바 영속성 관리와 ORM 기능을 제공하는 범용 ORM 기술로 만들어졌다. 현재 2.2버전까지 발표 되면서 발전하고 있다.

스프링은 JPA 1.0부터 JPA를 이용해서 데이터 접근 계층을 작성하는데 필요한 여러 기능을 지원하고 있다.

